# C국에게 받은 비밀지령

# Usage
-

# Concept
- document analysis

# Writeup
A씨가 C국과 내통을 하고있다는 사실을 안 정보국에서 A씨의 PC를 압수수색하였다. 
수사 중 A씨는 협업프로그램을 활용해 지령을 전달받은 점을 확인했다. 
A씨가 받은 파일과 파일 내 지령을 획득하라.

1.주어진 이미지 내에서 notion.db 파일을 export한다.

notion 내에 신도시프로젝트.pdf 파일이 업로드 되어있는것을 확인할 수 있다.

바탕화면에 있는 업무참고자료 폴더에 신도시프로젝트.pdf 파일 존재 확인 및 

Export 후 내부 내용을 확인해보면 겉으로는 이상이 없어 보인다.

2.
pdf 내부 stream을 확인해보면 이름이깨진 docm 파일이 첨부되어 있는것을 확인 할 수있고 파일의 데이터는 암호화 되어있는것을 확인할 수 있다. 

Base64로 암호화된 데이터를 hex 값으로 복호화 결과  헤더가 50 4B 03 04 14 00 06 00 으로 MS 문서 파일로 확인가능하다.

3.
복호화한 hex값을 파일로 생성한다.

무제1.docm 파일을 확인해본 결과 매크로가 실행되려는 모습을 볼 수 있다.

매크로가 속한 Project를 확인하려는 중 암호로 인해 확인이 불가하다.

암호화를 무력화 하기 위해서는  vbaProject.bin을 수정해줘야한다.

MS 문서파일은 zip 파일구조와 비슷한 구조를 가지기에 zip 파일 형식으로 변환 후 매크로 코드가 포함된 vbaProject.bin 을 수정해준다.


DPB로 암호화된 부분을 DPX로 수정 후 기존  vbaProject.bin 위치에 넣고 저장한다.


변경 후 파일을 실행시 오류 문구가 나온다.

예를 누른 후 Instruction_document매크로를 확인해보면


내부 코드를 확인할 수 있다.

중간에 주석처리된 base64로 암호된 문을 변환해보면


플래그가 확인 가능하다.

SPACEWAR{It_is_dark_under_the_lamp}