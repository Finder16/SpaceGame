#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include <stdlib.h>

#define DELTA 0x13379999

void decrypt(uint32_t v[2], uint32_t k[4]) {
    uint32_t v0 = v[0], v1 = v[1];
    uint32_t k0 = k[0], k1 = k[1], k2 = k[2], k3 = k[3];
    uint32_t sum = DELTA * 24;

    for (int i = 0; i < 24; i++) {
        v1 -= ((v0 >> 6) + k2) ^ (v0 + sum) ^ ((v0 << 3) + k3);
        v0 -= ((v1 >> 6) + k0) ^ (v1 + sum) ^ ((v1 << 3) + k1);
        sum -= DELTA;
    }
    v[0] = v0; v[1] = v1;
}

void recursive_decrypt(uint32_t v[2], uint32_t k[4], int count) {
    if (count > 0) {
        recursive_decrypt(v, k, count - 1);
        decrypt(v, k);
    }
}

int main() {
    uint32_t key[4] = { 0xfedcbabc, 0xcafebabe, 0x13379999, 0x4d3c2b1a };
    uint32_t enc[12] = {
        0x30273baa, 0x3ad7d031, 0xa60dd865, 0xf4cf1585,
        0x07eba521, 0x9c105bb6, 0xb461d5d2, 0x4bcd388a,
        0x84289038, 0xb1ea6f23, 0x01f6349e, 0xdf36a91a
    };
    
    uint32_t dec[12];
    memcpy(dec, enc, sizeof(enc));
    
    for (size_t i = 0; i < 12; i += 2) {
        recursive_decrypt(&dec[i], key, 24);
    }
    
    printf("Decrypted hex values:\n");
    for (int i = 0; i < 12; i++) {
        printf("%08x ", dec[i]);
    }
    printf("\n\nDecrypted string:\n");
    char* str = (char*)dec;
    for (size_t i = 0; i < sizeof(dec); i++) {
        if (str[i] >= 32 && str[i] <= 126) {
            printf("%c", str[i]);
        }
    }
    printf("\n");
    
    return 0;
}